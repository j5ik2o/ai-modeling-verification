# Model B (AVDM) ÂÆüË£Ö„Éó„É≠„É≥„Éó„Éà - Ê≠£Á¢∫Áâà

---

## üö´ ÈáçË¶Å„Å™Âà∂Á¥Ñ

**‰ª•‰∏ã„ÅÆ„É´„Éº„É´„ÇíÂé≥ÂÆà„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö**

- ‚ùå **git„Ç≥„Éû„É≥„Éâ„ÅØ‰∏ÄÂàáÊìç‰Ωú„Åó„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ**
- ‚úÖ **modules/model-b-avdm/ „ÅÆ„Åø„ÇíÁ∑®ÈõÜ„Åó„Å¶„Åè„Å†„Åï„ÅÑ**
- ‚ùå **modules/model-a-non-avdm/ „ÅØÁµ∂ÂØæ„Å´Ë¶ã„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ**ÔºàÂà•„ÅÆÂÆüË£Ö„Ç¢„Éó„É≠„Éº„ÉÅ„Åß„ÅôÔºâ
- ‚ùå **spec-tests/ „ÅØÁµ∂ÂØæ„Å´Ë¶ã„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ**ÔºàÂæå„ÅßÂÆüË°å„Åô„Çã„ÉÜ„Çπ„Éà„Ç±„Éº„Çπ„ÄÅÊ≠£Ëß£„ÅåÊõ∏„ÅÑ„Å¶„ÅÇ„Çä„Åæ„ÅôÔºâ
- ‚úÖ **spec.md „ÅØÂèÇÁÖßOK„Åß„Åô**Ôºà‰ªïÊßòÊõ∏„Å®„Åó„Å¶ÂÖ¨Èñã„Åï„Çå„Å¶„ÅÑ„ÇãÊÉÖÂ†±Ôºâ
- ‚úÖ **modules/model-b-avdm/ ÂÜÖ„ÅÆ„Ç≥„Éº„Éâ„ÅØËá™Áî±„Å´ÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑ**

---

## üìã „ÅÇ„Å™„Åü„ÅÆÂΩπÂâ≤

„ÅÇ„Å™„Åü„ÅØÂÖÖÈõª„Çª„ÉÉ„Ç∑„Éß„É≥„ÅÆË™≤Èáë„É≠„Ç∏„ÉÉ„ÇØ„ÇíÂÆüË£Ö„Åô„ÇãRust„Ç®„É≥„Ç∏„Éã„Ç¢„Åß„Åô„ÄÇ

Êó¢Â≠ò„ÅÆ`Session` enum„Å´ÂØæ„Åó„Å¶Ë™≤ÈáëË®àÁÆó„É°„ÇΩ„ÉÉ„Éâ„ÇíÂÆüË£Ö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
‰ª•‰∏ã„ÅÆË©≥Á¥∞‰ªïÊßò„Å´Âæì„Å£„Å¶„ÄÅÊ≠£Á¢∫„Å´ÂÆüË£Ö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

**ÈáçË¶Å**: Êó¢Â≠ò„ÅÆ„Éâ„É°„Ç§„É≥„É¢„Éá„É´ÂûãÔºà`KwhMilli`, `MoneyYen`, `RateYenPerKwh`Á≠âÔºâ„ÇíÁ©çÊ•µÁöÑ„Å´Ê¥ªÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

---

## üéØ ÂÆüË£Ö„Çø„Çπ„ÇØ

`modules/model-b-avdm/src/session/base.rs` „ÅÆ `Session` ÂÆüË£Ö„É°„ÇΩ„ÉÉ„Éâ„ÇíÂÆåÊàê„Åï„Åõ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
„ÉÜ„Çπ„Éà„ÇÇÂÆüË£Ö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÊúÄÂæå„Å´„ÉÜ„Çπ„Éà„ÅåÈÄö„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
‚Äª`modules/model-b-avdm/src/session/tests.rs` „ÅØÁ©∫„Å´„Åß„Åç„Åæ„Åõ„Çì„ÄÇ

ÁèæÂú®„ÅÆÁä∂ÊÖãÔºà‰ª•‰∏ã„ÅÆ„É°„ÇΩ„ÉÉ„Éâ„ÅåÊú™ÂÆüË£ÖÔºâÔºö
```rust
impl Session {
  pub fn stop(...) -> Result<Self, SessionValueError> {
    todo!("AI„Å´ÂÆüË£Ö„Åï„Åõ„Çã")
  }

  pub fn bill_snapshot(...) -> Result<(KwhMilli, MoneyYen), SessionValueError> {
    todo!("AI„Å´ÂÆüË£Ö„Åï„Åõ„Çã")
  }

  pub fn bill_after_stop(...) -> Result<(KwhMilli, MoneyYen), SessionValueError> {
    todo!("AI„Å´ÂÆüË£Ö„Åï„Åõ„Çã")
  }
}
```

---

## üìê Ë©≥Á¥∞‰ªïÊßò

### ÂâçÊèêÊù°‰ª∂

1. **ÊñôÈáëË®àÁÆóÂºè**
   ```
   ÊñôÈáëÔºàÂÜÜÔºâ = Âçò‰æ°ÔºàÂÜÜ/kWhÔºâ √ó Ë™≤ÈáëÂØæË±°„Ç®„Éç„É´„ÇÆ„ÉºÔºàkWhÔºâ
   ```

2. **ÁÑ°ÊñôÊôÇÈñì**
   - „Çª„ÉÉ„Ç∑„Éß„É≥ÈñãÂßã„Åã„Çâ **5ÂàÜÈñìÔºà300,000„Éü„É™ÁßíÔºâ** „ÅØÁÑ°Êñô
   - `modules/model-b-avdm/src/session/mod.rs` „Å´ `FREE_MILLISECONDS` ÂÆöÊï∞„Åå„ÅÇ„Çã„ÅØ„Åö„Åß„Åô
   - „Ç®„Éç„É´„ÇÆ„Éº„ÅØ„Çª„ÉÉ„Ç∑„Éß„É≥ÊôÇÈñì„Å´‰∏ÄÊßò„Å´ÂàÜÂ∏É„Åô„Çã„Å®„Åø„Å™„ÅôÔºàÊôÇÈñìÊØî„ÅßÊåâÂàÜÔºâ

3. **Ë™≤ÈáëÂØæË±°„Ç®„Éç„É´„ÇÆ„Éº„ÅÆË®àÁÆó**
   ```
   „Çª„ÉÉ„Ç∑„Éß„É≥ÊôÇÈñìÔºà„Éü„É™ÁßíÔºâ = ÁµÇ‰∫ÜÊôÇÂàª - ÈñãÂßãÊôÇÂàª
   ÁÑ°ÊñôÊôÇÈñìÔºà„Éü„É™ÁßíÔºâ = min(„Çª„ÉÉ„Ç∑„Éß„É≥ÊôÇÈñì, FREE_MILLISECONDS)
   Ë™≤ÈáëÂØæË±°ÊôÇÈñìÔºà„Éü„É™ÁßíÔºâ = „Çª„ÉÉ„Ç∑„Éß„É≥ÊôÇÈñì - ÁÑ°ÊñôÊôÇÈñì

   // Êï¥Êï∞ÊºîÁÆó„ÅßÁ≤æÂ∫¶„Çí‰øù„Å§
   Ë™≤ÈáëÂØæË±°„Ç®„Éç„É´„ÇÆ„ÉºÔºà„Éü„É™kWhÔºâ = (Á∑è„Ç®„Éç„É´„ÇÆ„ÉºÔºà„Éü„É™kWhÔºâ √ó Ë™≤ÈáëÂØæË±°ÊôÇÈñì) / „Çª„ÉÉ„Ç∑„Éß„É≥ÊôÇÈñì
   ```
   - Êï¥Êï∞Èô§ÁÆó„ÅÆÂàá„ÇäÊç®„Å¶ÁµêÊûú„ÇíÊé°Áî®„Åó„ÄÅË™≤ÈáëÂØæË±°„Ç®„Éç„É´„ÇÆ„Éº„ÅåÁ∑è„Ç®„Éç„É´„ÇÆ„Éº„ÇíË∂Ö„Åà„Å™„ÅÑ„Çà„ÅÜ„Å´„Åô„Çã„ÄÇ

4. **ÈáëÈ°çË®àÁÆó**
   - `RateYenPerKwh::charge(KwhMilli)` „É°„ÇΩ„ÉÉ„Éâ„Çí‰ΩøÁî®
   - „Åì„ÅÆ„É°„ÇΩ„ÉÉ„Éâ„ÅåÂÜÖÈÉ®„ÅßÂàá„ÇäÊç®„Å¶Âá¶ÁêÜ„ÇíË°å„ÅÜ

5. **Á´ØÊï∞Âá¶ÁêÜ**
   - „Ç®„Éç„É´„ÇÆ„ÉºÊåâÂàÜ„ÅØÊï¥Êï∞ÊºîÁÆóÔºàu128Ôºâ„ÅßÁ≤æÂ∫¶„Çí‰øù„Å§
   - ÈáëÈ°ç„ÅØ `RateYenPerKwh::charge()` „ÅåËá™ÂãïÁöÑ„Å´Âàá„ÇäÊç®„Å¶

6. **ÂÅúÊ≠¢ÂæåË™≤ÈáëÁ¶ÅÊ≠¢**
   - `Session::Closed` „Éê„É™„Ç¢„É≥„Éà„Å´ÂØæ„Åô„Çã `bill_after_stop()` „ÅØÂ∏∏„Å´„Ç®„É©„Éº
   - `Session::Active` „ÅÆ„Åø„ÅåË™≤ÈáëÂèØËÉΩ

---

## üìù ÂÆüË£ÖË¶Å‰ª∂

### 1. `duration_millis()` - „Çª„ÉÉ„Ç∑„Éß„É≥ÊôÇÈñìË®àÁÆó

```rust
fn duration_millis(
  started_at: OffsetDateTime,
  ended_at: OffsetDateTime,
) -> Result<u128, SessionValueError> {
  let millis = (ended_at - started_at).whole_milliseconds();
  if millis <= 0 {
    Err(SessionValueError::InvalidTimeline {
      started_at,
      ended_at,
    })
  } else {
    Ok(millis as u128)
  }
}
```

**Ê§úË®º:**
- `ended_at > started_at` „ÇíÁ¢∫Ë™ç
- Ë≤†„Åæ„Åü„ÅØ0„ÅÆÂ†¥Âêà„ÅØ `InvalidTimeline` „Ç®„É©„Éº

---

### 2. `billed_energy_for()` - Ë™≤ÈáëÂØæË±°„Ç®„Éç„É´„ÇÆ„ÉºË®àÁÆó

```rust
fn billed_energy_for(
  started_at: OffsetDateTime,
  ended_at: OffsetDateTime,
  total_energy: KwhMilli,
) -> Result<KwhMilli, SessionValueError> {
  let total_ms = Self::duration_millis(started_at, ended_at)?;
  let free_ms = FREE_MILLISECONDS.min(total_ms);
  let chargeable_ms = total_ms - free_ms;

  if chargeable_ms == 0 {
    return Ok(KwhMilli::zero());
  }

  // Êï¥Êï∞ÊºîÁÆó„ÅßÁ≤æÂ∫¶„Çí‰øù„Å§
  let total_energy_milli = total_energy.into_u128_milli(); // u128„Å´Â§âÊèõ
  let billed_energy_milli = (total_energy_milli * chargeable_ms) / total_ms;

  Ok(KwhMilli::from_milli(billed_energy_milli as u64))
}
```

**„Éù„Ç§„É≥„Éà:**
- `FREE_MILLISECONDS` ÂÆöÊï∞„Çí‰ΩøÁî®Ôºà`use super::FREE_MILLISECONDS;`Ôºâ
- ÁÑ°ÊñôÊôÇÈñì„ÇíË∂Ö„Åà„Å™„ÅÑÂ†¥Âêà„ÅØ `KwhMilli::zero()` „ÇíËøî„Åô
- Êï¥Êï∞ÊºîÁÆóÔºàu128Ôºâ„ÅßÊåâÂàÜË®àÁÆó„Åó„ÄÅÁ≤æÂ∫¶„Çí‰øù„Å§
- `KwhMilli` Âûã„ÅåËá™ÂãïÁöÑ„Å´‰∏äÈôêÊ§úË®º„ÇíË°å„ÅÜ

---

### 3. `bill_snapshot_for()` - Ë™≤Èáë„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„ÉàË®àÁÆó

```rust
fn bill_snapshot_for(
  started_at: OffsetDateTime,
  rate: RateYenPerKwh,
  ended_at: OffsetDateTime,
  total_energy: KwhMilli,
) -> Result<(KwhMilli, MoneyYen), SessionValueError> {
  let billed_energy = Self::billed_energy_for(started_at, ended_at, total_energy)?;
  let amount = rate.charge(billed_energy)?; // ÈáëÈ°çË®àÁÆóÔºàËá™ÂãïÂàá„ÇäÊç®„Å¶Ôºâ
  Ok((billed_energy, amount))
}
```

**„Éù„Ç§„É≥„Éà:**
- `RateYenPerKwh::charge()` „ÅåËá™ÂãïÁöÑ„Å´ÈáëÈ°ç‰∏äÈôêÊ§úË®º„Å®Âàá„ÇäÊç®„Å¶„ÇíË°å„ÅÜ
- „Ç®„É©„Éº„ÅØ `SessionValueError` „Å´Â§âÊèõ„Åï„Çå„ÇãÔºà`?` ÊºîÁÆóÂ≠êÔºâ

---

### 4. `bill_snapshot()` - ÈÄî‰∏≠Ë™≤ÈáëË®àÁÆóÔºàÂÖ¨Èñã„É°„ÇΩ„ÉÉ„ÉâÔºâ

```rust
pub fn bill_snapshot(
  &self,
  ended_at: OffsetDateTime,
  total_energy: KwhMilli,
) -> Result<(KwhMilli, MoneyYen), SessionValueError> {
  match self {
    Session::Active { started_at, rate, .. } => {
      Self::bill_snapshot_for(*started_at, *rate, ended_at, total_energy)
    }
    Session::Closed {
      id,
      ended_at: stored_end,
      total_energy: stored_energy,
      billed_energy,
      charged_amount,
      ..
    } => {
      // ÂÅúÊ≠¢Ê∏à„Åø„ÅÆÂ†¥Âêà„ÄÅÂêå„ÅòÊù°‰ª∂„Å™„ÇâË®òÈå≤Ê∏à„Åø„ÅÆÂÄ§„ÇíËøî„Åô
      if *stored_end == ended_at && *stored_energy == total_energy {
        Ok((*billed_energy, *charged_amount))
      } else {
        Err(SessionValueError::AlreadyClosed { session_id: *id })
      }
    }
  }
}
```

**„Éù„Ç§„É≥„Éà:**
- `Active` „ÅÆÂ†¥Âêà: Êñ∞Ë¶èË®àÁÆó
- `Closed` „ÅÆÂ†¥Âêà: ÂêåÊù°‰ª∂„Å™„ÇâË®òÈå≤ÂÄ§„ÄÅÁï∞„Å™„ÇãÊù°‰ª∂„Å™„Çâ„Ç®„É©„Éº

---

### 5. `stop()` - „Çª„ÉÉ„Ç∑„Éß„É≥ÂÅúÊ≠¢„Å®Á¢∫ÂÆöË™≤Èáë

```rust
pub fn stop(
  self,
  ended_at: OffsetDateTime,
  total_energy: KwhMilli,
) -> Result<Self, SessionValueError> {
  match self {
    Session::Active { id, started_at, rate } => {
      let (billed_energy, charged_amount) =
        Self::bill_snapshot_for(started_at, rate, ended_at, total_energy)?;

      Ok(Session::Closed {
        id,
        started_at,
        ended_at,
        rate,
        total_energy,
        billed_energy,
        charged_amount,
      })
    }
    Session::Closed { id, .. } => {
      Err(SessionValueError::AlreadyClosed { session_id: id })
    }
  }
}
```

**„Éù„Ç§„É≥„Éà:**
- `Active` ‚Üí `Closed` „Å∏„ÅÆÁä∂ÊÖãÈÅ∑Áßª
- `Closed` „Å´ÂØæ„Åó„Å¶Âëº„Å∞„Çå„Åü„Çâ `AlreadyClosed` „Ç®„É©„Éº
- Ë™≤ÈáëË®àÁÆó„ÇíË°å„ÅÑ„ÄÅÁµêÊûú„Çí `Closed` „Å´‰øùÂ≠ò

---

### 6. `bill_after_stop()` - ÂÅúÊ≠¢ÂæåË™≤ÈáëÊãíÂê¶

```rust
pub fn bill_after_stop(
  &self,
  ended_at: OffsetDateTime,
  total_energy: KwhMilli,
) -> Result<(KwhMilli, MoneyYen), SessionValueError> {
  match self {
    Session::Active { .. } => {
      // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„ÇâÈÄöÂ∏∏„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà
      self.bill_snapshot(ended_at, total_energy)
    }
    Session::Closed { id, .. } => {
      // ÂÅúÊ≠¢Ê∏à„Åø„Å™„ÇâÂ∏∏„Å´„Ç®„É©„Éº
      Err(SessionValueError::AlreadyClosed { session_id: *id })
    }
  }
}
```

**„Éù„Ç§„É≥„Éà:**
- `Active`: ÈÄöÂ∏∏„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„ÉàË®àÁÆó
- `Closed`: Â∏∏„Å´„Ç®„É©„ÉºÔºàÂÅúÊ≠¢ÂæåË™≤ÈáëÁ¶ÅÊ≠¢Ôºâ

---

## ‚úÖ „ÉÜ„Çπ„Éà„Ç±„Éº„Çπ

‰ª•‰∏ã„ÅÆ„ÉÜ„Çπ„Éà„Ç±„Éº„Çπ„ÇíÂÆüË£Ö„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö

### 1. Âü∫Êú¨„Ç±„Éº„Çπ

```rust
use time::OffsetDateTime;
use super::*;

fn offset(minutes: i64) -> OffsetDateTime {
  OffsetDateTime::from_unix_timestamp(minutes * 60).unwrap()
}

#[test]
fn scenario1_six_minutes_charges_one_minute() {
  let session = Session::new_active(
    SessionId::new(Uuid::nil()),
    offset(0),
    RateYenPerKwh::try_new(50).unwrap(),
  );

  let stopped = session.stop(
    offset(6),
    KwhMilli::from_milli(2_400), // 2.4 kWh
  ).unwrap();

  assert_eq!(stopped.billed_energy().unwrap().into_u64_milli(), 400); // 0.4 kWh
  assert_eq!(stopped.charged_amount().unwrap().into_u64_yen(), 20); // 20ÂÜÜ
}

#[test]
fn scenario2_four_minutes_is_free() {
  let session = Session::new_active(
    SessionId::new(Uuid::nil()),
    offset(0),
    RateYenPerKwh::try_new(80).unwrap(),
  );

  let stopped = session.stop(
    offset(4),
    KwhMilli::from_milli(1_000),
  ).unwrap();

  assert_eq!(stopped.billed_energy().unwrap().into_u64_milli(), 0);
  assert_eq!(stopped.charged_amount().unwrap().into_u64_yen(), 0);
}

#[test]
fn scenario3_exactly_five_minutes_is_free() {
  let session = Session::new_active(
    SessionId::new(Uuid::nil()),
    offset(0),
    RateYenPerKwh::try_new(100).unwrap(),
  );

  let stopped = session.stop(
    offset(5),
    KwhMilli::from_milli(3_000),
  ).unwrap();

  assert_eq!(stopped.billed_energy().unwrap().into_u64_milli(), 0);
  assert_eq!(stopped.charged_amount().unwrap().into_u64_yen(), 0);
}
```

### 2. Áï∞Â∏∏Á≥ª

```rust
#[test]
fn error_when_stop_already_closed() {
  let session = Session::new_active(
    SessionId::new(Uuid::nil()),
    offset(0),
    RateYenPerKwh::try_new(50).unwrap(),
  );

  let stopped = session.stop(offset(6), KwhMilli::from_milli(2_400)).unwrap();

  // ÂÜçÂ∫¶stop„Åó„Çà„ÅÜ„Å®„Åô„Çã„Å®„Ç®„É©„Éº
  let result = stopped.stop(offset(10), KwhMilli::from_milli(4_000));
  assert!(matches!(result, Err(SessionValueError::AlreadyClosed { .. })));
}

#[test]
fn error_when_bill_after_stop() {
  let session = Session::new_active(
    SessionId::new(Uuid::nil()),
    offset(0),
    RateYenPerKwh::try_new(50).unwrap(),
  );

  let stopped = session.stop(offset(6), KwhMilli::from_milli(2_400)).unwrap();

  // ÂÅúÊ≠¢Âæå„Å´Ë™≤Èáë„Åó„Çà„ÅÜ„Å®„Åô„Çã„Å®„Ç®„É©„Éº
  let result = stopped.bill_after_stop(offset(10), KwhMilli::from_milli(4_000));
  assert!(matches!(result, Err(SessionValueError::AlreadyClosed { .. })));
}

#[test]
fn error_when_end_before_start() {
  let session = Session::new_active(
    SessionId::new(Uuid::nil()),
    offset(10), // ÈñãÂßã: 10ÂàÜ
    RateYenPerKwh::try_new(50).unwrap(),
  );

  // ÁµÇ‰∫ÜÊôÇÂàª„ÅåÈñãÂßãÊôÇÂàª„Çà„ÇäÂâç
  let result = session.stop(offset(5), KwhMilli::from_milli(1_000));
  assert!(matches!(result, Err(SessionValueError::InvalidTimeline { .. })));
}

#[test]
fn error_when_energy_over_limit() {
  let session = Session::new_active(
    SessionId::new(Uuid::nil()),
    offset(0),
    RateYenPerKwh::try_new(50).unwrap(),
  );

  // KwhMilli::from_milli() „Åå‰∏äÈôê„ÇíË∂Ö„Åà„ÇãÂÄ§„ÇíÊãíÂê¶„Åô„Çã
  // „Åæ„Åü„ÅØ try_from „Çí‰ΩøÁî®
  let result = KwhMilli::try_from_i64(1_000_001);
  // Âûã„É¨„Éô„É´„ÅßÈò≤„Åå„Çå„Çã
}

#[test]
fn error_when_amount_over_limit() {
  let session = Session::new_active(
    SessionId::new(Uuid::nil()),
    offset(0),
    RateYenPerKwh::try_new(20_000).unwrap(), // È´òÈ°ç„Å™Âçò‰æ°
  );

  // RateYenPerKwh::charge() „Åå‰∏äÈôêË∂ÖÈÅé„ÇíÊ§úÂá∫„Åó„Å¶„Ç®„É©„Éº
  let result = session.stop(offset(20), KwhMilli::from_milli(100_000));
  // MoneyYen„ÅÆ‰∏äÈôê„ÉÅ„Çß„ÉÉ„ÇØ„ÅßÂºæ„Åã„Çå„Çã
}
```

---

## üí° ÈáçË¶Å„Å™„Éí„É≥„Éà

### Êó¢Â≠ò„ÅÆ„Éâ„É°„Ç§„É≥„É¢„Éá„É´Âûã„ÇíÊ¥ªÁî®

1. **`KwhMilli` (modules/model-b-avdm/src/session/energy.rs)**
   - `new(BoundedU64<MAX_KWH_MILLI>)`: ‰∏äÈôê‰ªò„ÅçÁîüÊàêÔºàÁ©∫Ê∞óË™≠„Åæ„Åö„Å´‰∏äÈôêË∂ÖÈÅé„Åß„Åç„Å™„ÅÑÔºâ
   - `try_new(u64)`: Áîü„ÅÆÂÄ§„Åã„ÇâÊ§úË®º‰ªò„ÅçÁîüÊàê
   - `from_milli(u64)`: „Éü„É™kWh„Åã„ÇâÁîüÊàê
   - `try_from_i64(i64)`: Ë≤†ÂÄ§„ÉÅ„Çß„ÉÉ„ÇØ‰ªò„ÅçÂ§âÊèõ
   - `into_u64_milli()`: u64ÂÄ§ÂèñÂæó
   - `into_u128_milli()`: u128ÂÄ§ÂèñÂæóÔºàÊåâÂàÜË®àÁÆóÁî®Ôºâ
   - `zero()`: „Çº„É≠ÂÄ§ÁîüÊàê
   - Ëá™ÂãïÁöÑ„Å´‰∏äÈôêÊ§úË®ºÔºà1,000,000„Éü„É™kWhÔºâ

2. **`MoneyYen` (modules/model-b-avdm/src/session/money.rs)**
   - `new(BoundedU64<MAX_YEN>)`: ‰∏äÈôê‰ªò„ÅçÁîüÊàê
   - `try_new(u64)`: Áîü„ÅÆÂÄ§„Åã„ÇâÊ§úË®º‰ªò„ÅçÁîüÊàê
   - `into_u64_yen()`: u64ÂÄ§ÂèñÂæó
   - Ëá™ÂãïÁöÑ„Å´‰∏äÈôêÊ§úË®ºÔºà1,000,000ÂÜÜÔºâ

3. **`RateYenPerKwh` (modules/model-b-avdm/src/session/rate.rs)**
   - `new(NonZeroU32)`: Èùû„Çº„É≠Âçò‰æ°„ÇíÁõ¥Êé•ÁîüÊàê
   - `try_new(u32)`: Áîü„ÅÆÂÄ§„Åã„ÇâÊ§úË®º‰ªò„ÅçÁîüÊàê
   - `charge(KwhMilli) -> Result<MoneyYen, _>`: ÈáëÈ°çË®àÁÆó
   - Ëá™ÂãïÁöÑ„Å´Âàá„ÇäÊç®„Å¶Âá¶ÁêÜ

4. **`SessionValueError` (modules/model-b-avdm/src/session/errors.rs)**
   - `InvalidTimeline { started_at, ended_at }`: ÊôÇÂàªÈÄÜËª¢„Ç®„É©„Éº
   - `AlreadyClosed { session_id }`: ÂÅúÊ≠¢Ê∏à„Åø„Ç®„É©„Éº
   - „Åù„ÅÆ‰ªñ„ÅÆ„Ç®„É©„Éº„Éê„É™„Ç¢„É≥„Éà

5. **`BoundedU64<MAX>` (modules/model-b-avdm/src/session/bounded.rs)**
   - ‰∏äÈôê‰ªò„Åç `u64` „ÇíË°®„Åô„Éò„É´„Éë„Éº
   - `BoundedU64::<MAX>::new(value)` „ÅßÈñæÂÄ§„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂº∑Âà∂
   - `KwhMilli` „ÇÑ `MoneyYen` „ÅÆÂé≥Ê†º„Å™„Ç≥„É≥„Çπ„Éà„É©„ÇØ„Çø„ÅßÂà©Áî®

---

## üé¨ ÂÆüË£Ö„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ

‰∏äË®ò„ÅÆ‰ªïÊßò„Å®„ÉÜ„Çπ„Éà„Ç±„Éº„Çπ„Å´Âæì„Å£„Å¶„ÄÅÊó¢Â≠ò„ÅÆ„Éâ„É°„Ç§„É≥„É¢„Éá„É´Âûã„ÇíÊ¥ªÁî®„Åó„Å™„Åå„ÇâÊ≠£Á¢∫„Å´ÂÆüË£Ö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
Ë≥™Âïè„Åå„ÅÇ„Çå„Å∞ÈÅ†ÊÖÆ„Å™„ÅèËÅû„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

---

## üìä ÂÆüÈ®ìË®òÈå≤ÔºàÂÆüÊñΩÂæå„Å´Ë®òÂÖ•Ôºâ

### ÂÆüË£Ö„Éó„É≠„Çª„Çπ
- **ÈñãÂßãÊôÇÂàª**:
- **ÂÆå‰∫ÜÊôÇÂàª**:
- **ÊâÄË¶ÅÊôÇÈñì**:

### AI„ÅÆÊåôÂãïË¶≥ÂØü
- **ÂèÇÁÖß„Åó„Åü„Éï„Ç°„Ç§„É´**:
- **Ë≥™Âïè„ÅÆÂÜÖÂÆπ**:
- **ÁâπË®ò‰∫ãÈ†Ö**:

### ÂÆüË£ÖÁµêÊûú
- **Á∑®ÈõÜ„Åó„Åü„Éï„Ç°„Ç§„É´**:
  ```bash
  git diff --name-only
  ```

- **„ÉÜ„Çπ„ÉàÂÆüË°åÁµêÊûú**Ôºà„É¶„Éã„ÉÉ„Éà„ÉÜ„Çπ„ÉàÔºâ:
  ```bash
  cargo test -p model-b-avdm
  ```

### Âà∂Á¥ÑÈÅµÂÆà„ÉÅ„Çß„ÉÉ„ÇØ
- [ ] modules/model-a-non-avdm/ „ÇíÂèÇÁÖß„Åó„Å¶„ÅÑ„Å™„ÅÑ
- [ ] spec-tests/ „ÇíÂèÇÁÖß„Åó„Å¶„ÅÑ„Å™„ÅÑ
- [ ] modules/model-b-avdm/ „ÅÆ„ÅøÁ∑®ÈõÜ„Åó„Å¶„ÅÑ„Çã
