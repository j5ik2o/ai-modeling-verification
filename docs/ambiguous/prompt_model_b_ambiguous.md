# Model B (AVDM) 実装プロンプト - あいまい版

> **実験日時**: [実施時に記録]
> **実験者**: [実施者名]
> **Claude Codeセッション**: 新規セッション（Model A実装とは完全に独立）

---

## 🚫 重要な制約

**以下のルールを厳守してください：**

- ❌ **gitコマンドは一切操作しないでください**
- ✅ **modules/model-b-avdm/ のみを編集してください**
- ❌ **modules/model-a-non-avdm/ は絶対に見ないでください**（別の実装アプローチです）
- ❌ **spec-tests/ は絶対に見ないでください**（後で実行するテストケース、正解が書いてあります）
- ❌ **spec.md は参照しないでください**
- ✅ **modules/model-b-avdm/ 内のコードは自由に参照してください**

---

## 📋 あなたの役割

あなたは充電セッションの課金ロジックを実装するRustエンジニアです。

既存の`Session` enum/構造体に対して課金計算メソッドを実装してください。
ドメインモデルの型定義は既に存在するので、それらを活用してください。

---

## 🎯 実装タスク

`modules/model-b-avdm/src/session/base.rs` の `Session` 実装メソッドを完成させてください。テストも実装してください。

現在の状態（以下のメソッドが未実装）：
```rust
impl Session {
  pub fn stop(...) -> Result<Self, SessionValueError> {
    todo!("AIに実装させる")
  }

  pub fn bill_snapshot(...) -> Result<(KwhMilli, MoneyYen), SessionValueError> {
    todo!("AIに実装させる")
  }

  pub fn bill_after_stop(...) -> Result<(KwhMilli, MoneyYen), SessionValueError> {
    todo!("AIに実装させる")
  }
}
```

最後にテストが通ることを確認してください。

---

## 📝 要件（意図的に曖昧）

EV充電セッションの課金処理を仕上げたいです。以下のような挙動を実現してください：

### 基本的な挙動
1. **開始から一定時間は無料にしたい**
   - 短時間のサービス枠があります（何分かは常識的に判断してください）
   - 開始直後にちょっとエネルギーが増えただけなら無料扱いにしたい

2. **途中で課金額を確認できるようにしたい**
   - スタートしたら途中で様子を見ることもあります

3. **最終的に停止して確定請求したい**
   - 最後に止めて確定請求したいこともあります

### 安全性・堅牢性
4. **非常識な入力は受け付けないようにしたい**
   - 現実とかけ離れた入力はそのまま受け付けないようにしたい
   - 桁外れのエネルギーや金額になりそうなら無理せず弾いてほしい

5. **一貫性を保ちたい**
   - 決定性（同じ条件なら同じ結果）も大事にしましょう
   - 止めたあとにまた請求しようとしたら断りたい

### テストについて
テストも書いてください。以下のようなケースを押さえてほしいです：

- **日常的な利用パターン**
  - 普通の充電セッション（数分〜数十分）
  - ゼロエネルギーのケース
  - 長時間利用のケース

- **境界条件**
  - 無料時間ちょうどのケース
  - 無料時間を少しだけ超えるケース

- **異常系（不正っぽい操作）**
  - 停止後に再度課金しようとする
  - 負のエネルギー値
  - 時間の逆転（終了時刻が開始時刻より前）
  - 桁外れのエネルギー量
  - 桁外れの金額

---

## 💡 ヒント

- 細かい条件は明文化しきれませんが、後から追加で境界ケースを突っ込まれても破綻しない造りとテストをお願いします
- そのへんは常識的に整えておいてください
- 既存のコード（`modules/model-b-avdm/` 内）を参考にして、プロジェクトの慣習に従ってください
- **既存のドメインモデル型（値オブジェクト等）を積極的に活用してください**

---

## 🎬 実装を開始してください

準備ができたら、実装を開始してください。
質問があれば遠慮なく聞いてください（ただし、spec-tests/の内容については答えられません）。

---

## 📊 実験記録（実施後に記入）

### 実装プロセス
- **開始時刻**:
- **完了時刻**:
- **所要時間**:

### AIの挙動観察
- **参照したファイル**:
- **質問の内容**:
- **仮定した内容**:
- **特記事項**:

### 実装結果
- **編集したファイル**:
  ```bash
  git diff --name-only
  ```

- **テスト実行結果**（ユニットテスト）:
  ```bash
  cargo test -p model-b-avdm
  ```

### 制約遵守チェック
- [ ] modules/model-a-non-avdm/ を参照していない
- [ ] spec-tests/ を参照していない
- [ ] modules/model-b-avdm/ のみ編集している
