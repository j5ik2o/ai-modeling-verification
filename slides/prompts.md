# プロンプト

## 精密プロンプト

```
あなたは充電セッションの課金ロジックを実装・検証する Rust エンジニアです。

既存のSessionに対して以下の仕様で実装してください。

## 基本仕様

- セッションは開始時刻（エポックミリ秒）と単価（円/kWh）を受け取り開始する。
- 料金はスナップショット課金（途中経過）と停止時の確定課金をサポートする。
- 課金対象エネルギーは「総エネルギー × 有料時間比率」。最初の5分間のエネルギーは無料扱い。エネルギーは時間に一様分布するとみなす。
- 金額は常に1円未満を切り捨てる。
- 停止後は追加課金できない。
- タイムラインは単調増加が必須（停止時刻 < 開始時刻は禁止）。
- エネルギー入力はミリkWh単位の整数。負の値は禁止。総エネルギーは1,000,000ミリkWh（=1,000kWh）まで。
- 請求金額は100万円まで。これを超える計算はエラーとする。
- 同じ入力を与えたら毎回同じ結果（決定性）になること。

## 受入テストでチェックする主要シナリオ

1. 6分利用・総エネルギー2.4kWh・単価50円/kWh → 無料5分を除き、課金対象0.4kWh・金額20円。
2. 4分利用・総エネルギー1.0kWh・単価80円/kWh → 全量無料で0円。
3. 5分丁度で終了・総エネルギー3.0kWh・単価100円/kWh → 無料枠のみで0円。
4. 20分利用・総エネルギー6.0kWh・単価40円/kWh → 課金対象比率0.75、課金4.5kWh・金額180円。
5. 進行中スナップショット: 3分(1.2kWh)→0円、6分(2.4kWh)→20円、10分(4.0kWh)→100円。金額は単調増加で矛盾しないこと。
6. 停止後に課金しようとするとエラーになること。
7. 停止時刻が5分ぴったりの場合は0円。
8. 総エネルギーが0なら常に0円。
9. エネルギーが負ならスナップショット・停止ともにエラー。
10. 停止時刻が開始より前ならエラー。
11. 同じ入力を複数回与えても結果が同じであること。
12. 端数が出るケースで常に切り捨てが行われ、利用時間が長い方が安くならない（単調性）。
13. 10分利用・総エネルギー1,000,000ミリkWh・単価2,000円/kWh → 課金対象500,000ミリkWh、金額1,000,000円（上限丁度）になること。
14. 金額が100万円を超える組合せ（例: 単価2,001円/kWh、総エネルギー1,000,000ミリkWh）ではスナップショット・停止ともにエラー。
15. 総エネルギーが上限を超える入力（1,000,001ミリkWh）ではスナップショット・停止ともにエラー。

## 補助関数の期待挙動

- `bill_snapshot(end_ms, energy_milli)` は課金対象エネルギー量と請求金額を返す。エラー条件は時間逆転、負のエネルギー、エネルギー上限超過、金額上限超過など。
- `stop(end_ms, energy_milli)` はスナップショットと同じ計算を行い、確定結果と停止済みハンドルを返す。停止済みハンドルから `bill_after_stop` を呼ぶと必ずエラー。
- 決定性のため、同一セッション・同一入力では常に同じ結果を返す。

この仕様に合格するようにモデルA/B双方の実装を検証・整備してください。
```


## 不明確プロンプト

```
あなたは充電セッションの課金ロジックを実装・検証する Rust エンジニアです。

既存のSession に対して以下の仕様で実装してください。使えるドメインモデルの実装はすでにあります。それらを使って実装してください。

EV 充電セッションの課金処理を仕上げたいです。スタートしたら途中で様子を見ることもあるし、最後に止めて確定請求したいこともありますよね。短時間のサービス枠があったり、現実とかけ離れた入力はそもそも受け付けないようにしたいので、そのへんは常識的に整えておいてください。

テストでは、日常的な利用パターンから“不正っぽい”操作までいくつか押さえておきたいです。たとえば、開始直後にちょっとエネルギーが増えただけなら無料扱いになるし、止めたあとにまた請求しようとしたら断りたいし、桁外れのエネルギーや金額になりそうなら無理せず弾いてほしい、みたいなイメージです。決定性（同じ条件なら同じ結果）も大事にしましょう。

細かい条件は明文化しきれませんが、後から追加で境界ケースを突っ込まれても破綻しない造りとテストをお願いします。
```