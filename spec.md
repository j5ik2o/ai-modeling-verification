# Charging Session Lite – 受け入れテスト仕様書（自然言語）

## 前提
- 料金は「単価（円/kWh） × 課金対象エネルギー（kWh）」で算出する。
- **最初の5分は無料**：セッション開始から5分間に相当するエネルギーは請求対象に含めない。
    - エネルギーはセッション時間に**一様に分布**するものとみなす（時間比で按分）。
- 無料枠を差し引いた課金対象エネルギーは、按分結果を**切り捨て（floor）**して元の総エネルギーを超えないようにする。
- 金額は**1円未満を切り捨て**る。
- **停止後は課金できない**（停止済みセッションに対する追加課金は拒否される）。
- 入力は妥当な時刻（開始 < 停止）を前提とする。不正入力は拒否される。

---

## テストシナリオ

### シナリオ1：6分利用で最初5分無料が適用される
- **Given** 単価 50 円/kWh、総エネルギー 2.4 kWh、セッション長 6 分
- **When** 料金を計算する
- **Then** 無料5分を除く1分相当のエネルギーのみ課金対象
    - 課金対象エネルギー = 2.4 × (1/6) = 0.4 kWh
    - 料金 = 0.4 × 50 = **20 円**

---

### シナリオ2：4分利用は無料枠内で0円
- **Given** 単価 80 円/kWh、総エネルギー 1.0 kWh、セッション長 4 分
- **When** 料金を計算する
- **Then** 全量が無料枠内 → **0 円**

---

### シナリオ3：ぴったり5分も無料扱い
- **Given** 単価 100 円/kWh、総エネルギー 3.0 kWh、セッション長 5 分
- **When** 料金を計算する
- **Then** 無料枠のみで終了 → **0 円**

---

### シナリオ4：20分利用で無料枠後の比率が正しく計算される
- **Given** 単価 40 円/kWh、総エネルギー 6.0 kWh、セッション長 20 分
- **When** 料金を計算する
- **Then** 課金対象比率 = (20−5)/20 = 0.75
    - 課金対象エネルギー = 6.0 × 0.75 = 4.5 kWh
    - 料金 = 4.5 × 40 = **180 円**

---

### シナリオ5：途中請求の累積が一貫している
- **Given** 単価 50 円/kWh、セッション進行中
- **When** 開始から3分・6分・10分時点でそれぞれ料金を計算する
- **Then**
    - 3分時点：0円
    - 6分時点：20円（シナリオ1と同じ）
    - 10分時点：課金対象比率 = (10−5)/10 = 0.5
        - 時間に比例して金額が一貫して増加し、同条件では同額（**決定性**）となる

---

### シナリオ6：停止後に課金できない
- **Given** セッションが**停止済み**
- **When** 停止後に課金を試みる
- **Then** 処理は拒否され、料金は増えない（例：エラーまたは呼び出し不可）

---

### シナリオ7：停止時刻が5分ぴったりの場合も0円
- **Given** 単価 60 円/kWh、総エネルギー任意、停止時刻が開始から5分
- **When** 料金を計算する
- **Then** 無料枠のみで終了 → **0 円**

---

### シナリオ8：ゼロエネルギーでは0円
- **Given** 総エネルギー 0 kWh
- **When** 料金を計算する
- **Then** **0 円**

---

### シナリオ9：負のエネルギーは不正
- **Given** 総エネルギーが負の値
- **When** セッションまたは料金計算を試みる
- **Then** **不正入力として拒否**される

---

### シナリオ10：停止が開始より前は不正
- **Given** 停止時刻が開始時刻より前
- **When** セッションを確定または料金計算しようとする
- **Then** **不正入力として拒否**される

---

### シナリオ11：同じ入力は同じ結果（決定性）
- **Given** 同一の入力（単価・エネルギー・時刻）
- **When** 料金を複数回計算する
- **Then** **毎回同じ金額**が得られる

---

### シナリオ12：小数端数は切り捨て
- **Given** 計算で小数点以下が出るケース
- **When** 料金を計算する
- **Then** **1円未満は切り捨て**で一貫し、逆転現象（利用が長いのに安い）は起きない
